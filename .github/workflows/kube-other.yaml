name: kube-other
on:
  push:
    branches:
      - kube-other
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # - uses: actions/checkout@v2
#      - name: Login in Docker Registry
#        uses: docker/login-action@v1
#        with:
#          registry: ghcr.io
#          username: ${{ github.repository_owner }}
#          password: ${{ secrets.GHCR_IO_TOKEN }} 

      - name: Login in Docker Registry 
        uses: docker/login-action@v1
        with:
         username: ${{ secrets.DOCKER_USERNAME }}
         password: ${{ secrets.DOCKER_PASSWORD }}
         
     - name: get images name
       run: |
          docker_orgin_images=$(docker image ls --format "{{.Repository}}:{{.Tag}}")
          echo $docker_orgin_images > ~/images.txt
          echo ~/images.txt
          cat  ~/images.txt
  
         
      - name: Docker pull 
        run: |
            docker pull gcr.io/k8s-staging-sig-storage/objectstorage-sidecar/objectstorage-sidecar:v20230130-v0.1.0-24-gc0cf995
            docker pull quay.io/ceph/ceph:v17.2.6
            docker pull quay.io/ceph/cosi:v0.1.0
            docker pull quay.io/cephcsi/cephcsi:v3.9.0
            docker pull quay.io/csiaddons/k8s-sidecar:v0.7.0
            docker pull registry.k8s.io/sig-storage/csi-attacher:v4.3.0
            docker pull registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.8.0
            docker pull registry.k8s.io/sig-storage/csi-provisioner:v3.5.0
            docker pull registry.k8s.io/sig-storage/csi-resizer:v1.8.0
            docker pull registry.k8s.io/sig-storage/csi-snapshotter:v6.2.2
            docker pull rook/ceph:master
#      - name: Docker push ghcr.io
#        run: |
#          docker_orgin_images=$(docker image ls --format "{{.Repository}}:{{.Tag}}")
#          echo $docker_orgin_images > ~/images.txt
#          echo ~/images.txt

#      - name: Docker push ghcr.io
#        run: |
#          images=$(cat ~/images.txt)
#          for i in $images;do
#            docker tag  $i ghcr.io/${{ github.repository_owner }}/${i##*/}
#            docker push ghcr.io/${{ github.repository_owner }}/${i##*/}
#          done
          
      - name: Docke push 
        run: |
          images=$(cat ~/images.txt)
          for i in $images;do
            docker tag  $i ${{ secrets.DOCKER_USERNAME }}/${i##*/}
            docker push ${{ secrets.DOCKER_USERNAME }}/${i##*/}
          done
          
